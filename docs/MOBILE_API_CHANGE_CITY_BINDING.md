# City endpoint binding change â€” API note for Mobile App AI Agent

Summary
- We changed the public city endpoints to bind by numeric ID instead of slug for the main public API routes. This allows calls like `/api/v1/cities/4/services` to work.

What changed
- Updated `routes/api.php` (public routes under `/api/v1`) to use `{city:id}` for city-specific endpoints:
  - `GET /api/v1/cities/{city:id}`
  - `GET /api/v1/cities/{city:id}/featured-shops`
  - `GET /api/v1/cities/{city:id}/latest-shops`
  - `GET /api/v1/cities/{city:id}/statistics`
  - `GET /api/v1/cities/{city:id}/banners`
  - `GET /api/v1/cities/{city:id}/services`

Why
- The `City` model uses `getRouteKeyName()` returning `slug` by default, so previously the API expected slugs (e.g., `cairo`). Using numeric IDs ensures the mobile client can call endpoints with numeric city IDs coming from the app's data store without needing slugs.

Client migration notes
- If your mobile app currently calls city endpoints using a slug, those calls will still continue to work only if you change the client to call by ID or the server re-introduces slug-based routes.
- Recommended approach for the mobile app:
  - Prefer calling by ID to avoid needing slug resolution.
  - Example request (ID-based):

    curl -X GET "http://127.0.0.1:8000/api/v1/cities/4/services?sort=latest&per_page=15&page=1"

  - Example request (PowerShell):

    Invoke-RestMethod -Uri "http://127.0.0.1:8000/api/v1/cities/4/services?sort=latest&per_page=15&page=1" -Method GET

- If the app has only slugs available and you want to continue using slugs, options:
  - Use the slug endpoints instead (server can be left unchanged and client should request `/api/v1/cities/{slug}/...`), or
  - Server: add separate slug routes or revert `getRouteKeyName()` change.

Server-side alternatives (for backend engineers)
- Keep slug-based binding (current default) and change mobile client to fetch/maintain slugs.
- Add dual binding: create separate routes for `{city:slug}` and `{city:id}`, or implement custom route binding to detect numeric IDs and use `findOrFail` appropriately.

Testing
- Verify endpoints with numeric ID:
  - `GET /api/v1/cities/4/services`
  - `GET /api/v1/cities/4`
- If you see 404 for id 4, ensure the city with `id=4` exists and `is_active` is true in the `cities` table.

Contact
- For follow-up, ask backend team to add slug-based compatibility if the mobile product depends on slugs.

Generated by: Dev automation update
Date: 2025-11-26
